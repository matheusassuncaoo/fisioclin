<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Sistema de Evolução de Pacientes - Fisioterapia" />
    <title>FisioClin - Evolução de Pacientes</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700&display=swap" rel="stylesheet">

    <!-- Icons -->
    <script src="https://unpkg.com/feather-icons"></script>

    <!-- Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="Assets/css/app.css" />
</head>
<body>
    <div id="app" class="app-wrapper">
        
        <!-- ==================== HEADER FIXO ==================== -->
        <header class="app-header">
            <div class="header-left">
                <button id="btnVoltar" class="btn-back hidden" title="Voltar">
                    <i data-feather="arrow-left"></i>
                </button>
                <div class="brand">
                    <div class="brand-icon">
                        <i data-feather="activity"></i>
                    </div>
                    <div class="brand-text">
                        <span class="brand-name">FisioClin</span>
                        <span class="brand-subtitle">Fisioterapia</span>
                    </div>
                </div>
            </div>
            
            <div class="header-center">
                <h1 id="pageTitle" class="page-title">Selecionar Paciente</h1>
            </div>
            
            <div class="header-right">
                <!-- Área preparada para login futuro -->
                <div class="user-menu" id="userMenu">
                    <div class="user-avatar">
                        <i data-feather="user"></i>
                    </div>
                    <div class="user-info">
                        <span class="user-name" id="userName">Profissional</span>
                        <span class="user-role" id="userRole">Fisioterapeuta</span>
                    </div>
                    <button class="btn-icon" id="btnUserOptions" title="Opções">
                        <i data-feather="chevron-down"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- ==================== CONTEÚDO PRINCIPAL ==================== -->
        <main class="app-main">
            
            <!-- Loading Overlay -->
            <div id="loadingOverlay" class="loading-overlay hidden">
                <div class="loading-content">
                    <div class="spinner"></div>
                    <p>Carregando...</p>
                </div>
            </div>

            <!-- ========== TELA 1: SELEÇÃO DE PACIENTE ========== -->
            <section id="telaSelecao" class="tela active">
                
                <!-- Cards de Resumo -->
                <div class="dashboard-cards">
                    <div class="dash-card">
                        <div class="dash-card-icon" style="background: linear-gradient(135deg, #10b981, #059669);">
                            <i data-feather="users"></i>
                        </div>
                        <div class="dash-card-info">
                            <span class="dash-card-value" id="totalPacientesAtivos">--</span>
                            <span class="dash-card-label">Pacientes Ativos</span>
                        </div>
                    </div>
                    <div class="dash-card">
                        <div class="dash-card-icon" style="background: linear-gradient(135deg, #3b82f6, #2563eb);">
                            <i data-feather="calendar"></i>
                        </div>
                        <div class="dash-card-info">
                            <span class="dash-card-value" id="atendimentosHoje">--</span>
                            <span class="dash-card-label">Atendimentos Hoje</span>
                        </div>
                    </div>
                    <div class="dash-card">
                        <div class="dash-card-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                            <i data-feather="clipboard"></i>
                        </div>
                        <div class="dash-card-info">
                            <span class="dash-card-value" id="anamnesesPendentes">--</span>
                            <span class="dash-card-label">Anamneses Pendentes</span>
                        </div>
                    </div>
                </div>

                <!-- Busca e Filtros -->
                <div class="search-section">
                    <div class="search-box">
                        <i data-feather="search"></i>
                        <input 
                            type="text" 
                            id="inputBuscaPaciente" 
                            placeholder="Buscar paciente por nome, RG ou CPF..."
                            autocomplete="off"
                        />
                        <button class="btn-clear-search hidden" id="btnLimparBusca">
                            <i data-feather="x"></i>
                        </button>
                    </div>
                    <div class="filter-group">
                        <select id="filterEspecialidade" class="filter-select">
                            <option value="30" selected>Fisioterapia</option>
                            <option value="">Todas Especialidades</option>
                            <option value="00">Biomedicina</option>
                            <option value="10">Enfermagem</option>
                            <option value="20">Estética</option>
                            <option value="40">Nutrição</option>
                            <option value="50">Odontologia</option>
                            <option value="70">Psicologia</option>
                        </select>
                        <select id="filterStatus" class="filter-select">
                            <option value="true" selected>✓ Ativos</option>
                            <option value="false">✗ Inativos</option>
                            <option value="">Todos</option>
                        </select>
                    </div>
                </div>

                <!-- Lista de Pacientes -->
                <div class="pacientes-grid" id="pacientesGrid">
                    <!-- Cards de pacientes serão inseridos aqui via JS -->
                    <div class="loading-placeholder">
                        <div class="spinner"></div>
                        <p>Carregando pacientes...</p>
                    </div>
                </div>

                <!-- Empty State -->
                <div class="empty-state hidden" id="emptyStatePacientes">
                    <i data-feather="users"></i>
                    <h3>Nenhum paciente encontrado</h3>
                    <p>Tente ajustar os filtros ou buscar por outro termo</p>
                </div>

            </section>

            <!-- ========== TELA 2: EVOLUÇÃO DO PACIENTE ========== -->
            <section id="telaEvolucao" class="tela">
                
                <!-- Header do Paciente -->
                <div class="paciente-header">
                    <div class="paciente-avatar">
                        <span id="pacienteIniciais">--</span>
                    </div>
                    <div class="paciente-info">
                        <h2 id="pacienteNome">Nome do Paciente</h2>
                        <div class="paciente-meta">
                            <span><i data-feather="hash"></i> ID: <strong id="pacienteId">--</strong></span>
                            <span><i data-feather="credit-card"></i> CPF: <strong id="pacienteCpf">--</strong></span>
                            <span><i data-feather="file-text"></i> RG: <strong id="pacienteRg">--</strong></span>
                            <span class="status-badge" id="pacienteStatus">Ativo</span>
                        </div>
                    </div>
                </div>

                <!-- Tabs de Navegação -->
                <div class="tabs-container">
                    <div class="tabs-nav">
                        <button class="tab-btn active" data-tab="evolucao">
                            <i data-feather="edit-3"></i> Nova Evolução
                        </button>
                        <button class="tab-btn" data-tab="historico">
                            <i data-feather="clock"></i> Histórico
                        </button>
                        <button class="tab-btn" data-tab="exercicios">
                            <i data-feather="activity"></i> Exercícios Realizados
                        </button>
                    </div>
                </div>

                <!-- Tab Content: Nova Evolução SOAP -->
                <div id="tabEvolucao" class="tab-panel active">
                    <div class="evolucao-container">
                        <!-- Resumo Rápido -->
                        <div class="quick-stats">
                            <div class="quick-stat">
                                <span class="quick-stat-value" id="statTotalSessoes">0</span>
                                <span class="quick-stat-label">Sessões</span>
                            </div>
                            <div class="quick-stat">
                                <span class="quick-stat-value" id="statDiasTratamento">0</span>
                                <span class="quick-stat-label">Dias</span>
                            </div>
                            <div class="quick-stat">
                                <span class="quick-stat-value" id="statFrequencia">0x</span>
                                <span class="quick-stat-label">Freq/Semana</span>
                            </div>
                            <div class="quick-stat">
                                <span class="quick-stat-value" id="statUltimoAtend">--</span>
                                <span class="quick-stat-label">Último Atend.</span>
                            </div>
                        </div>

                        <!-- Formulário de Atendimento -->
                        <form id="formEvolucao" class="atendimento-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="inputDataAtend">
                                        <i data-feather="calendar"></i> Data do Atendimento
                                    </label>
                                    <input type="date" id="inputDataAtend" required />
                                </div>
                                <div class="form-group">
                                    <label for="selectProcedimento">
                                        <i data-feather="briefcase"></i> Procedimento
                                    </label>
                                    <select id="selectProcedimento" required>
                                        <option value="">Selecione...</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="inputProfissional">
                                        <i data-feather="user"></i> ID Profissional
                                    </label>
                                    <input type="number" id="inputProfissional" placeholder="Digite o ID do profissional" required />
                                    <small class="form-hint" id="nomeProfissionalHint" style="display: none; color: #10b981; margin-top: 4px;"></small>
                                </div>
                            </div>

                            <div class="form-group full-width">
                                <label for="inputDescricao">
                                    <i data-feather="file-text"></i> Evolução do Paciente
                                </label>
                                <textarea 
                                    id="inputDescricao" 
                                    placeholder="Descreva a evolução do paciente, conduta realizada, observações..."
                                    rows="6"
                                    maxlength="250"
                                ></textarea>
                                <small class="char-counter"><span id="charCount">0</span>/250 caracteres</small>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn btn-outline" id="btnLimparForm">
                                    <i data-feather="trash-2"></i> Limpar
                                </button>
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i data-feather="save"></i> Salvar Evolução
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Tab Content: Histórico -->
                <div id="tabHistorico" class="tab-panel">
                    <div class="historico-container">
                        <div class="timeline" id="historicoTimeline">
                            <div class="loading-placeholder">
                                <div class="spinner"></div>
                                <p>Carregando histórico...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Exercícios Realizados -->
                <div id="tabExercicios" class="tab-panel">
                    <div class="exercicios-container">
                        <div class="exercicios-header">
                            <h3>Exercícios Realizados</h3>
                        </div>
                        <div class="info-notice">
                            <i data-feather="info"></i>
                            <p>O registro de exercícios requer autenticação do profissional. O fluxo completo é: <strong>Anamnese → Prescrição → Realização</strong></p>
                        </div>
                        <div class="exercicios-list" id="exerciciosList">
                            <div class="loading-placeholder">
                                <div class="spinner"></div>
                                <p>Carregando exercícios...</p>
                            </div>
                        </div>
                    </div>
                </div>

            </section>

        </main>

        <!-- ==================== FOOTER ==================== -->
        <footer class="app-footer">
            <p>FisioClin &copy; 2025 - Sistema de Evolução de Pacientes</p>
            <p class="version">Especialidade: <strong>Fisioterapia (30)</strong></p>
        </footer>

    </div>

    <!-- ==================== MODAL DETALHES ATENDIMENTO ==================== -->
    <div id="modalDetalhes" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="modalDetalhesTitle">Detalhes da Evolução</h3>
                <button class="btn-close" id="btnCloseModal">
                    <i data-feather="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="detalhe-info">
                    <div class="detalhe-row">
                        <span class="detalhe-label">Data:</span>
                        <span class="detalhe-value" id="modalData">--</span>
                    </div>
                    <div class="detalhe-row">
                        <span class="detalhe-label">Procedimento:</span>
                        <span class="detalhe-value" id="modalProcedimento">--</span>
                    </div>
                    <div class="detalhe-row">
                        <span class="detalhe-label">Profissional:</span>
                        <span class="detalhe-value" id="modalProfissional">--</span>
                    </div>
                </div>
                <div class="detalhe-descricao">
                    <label>Descrição Completa:</label>
                    <div class="descricao-box" id="modalDescricao">
                        --
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="btnFecharModal">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="Assets/js/notifications.js"></script>
    <script src="Assets/js/apiManager.js"></script>
    <script src="Assets/js/app.js"></script>
    <script>
        feather.replace();
        // Inicializar aplicação
        document.addEventListener('DOMContentLoaded', () => {
            window.app = new FisioApp();
        });
    </script>
</body>
</html>
